# Исправление синтаксической ошибки в SQL-запросе

## Требования
- Исправить синтаксическую ошибку в создании таблицы rag_docs
- Добавить автотестирование и логирование для обеспечения надежности системы
- Обеспечить совместимость с SQLite

## Архитектурное решение
1. **Исправление синтаксиса**:
   - Разделить создание таблицы и индексов на отдельные команды
   - Использовать правильный синтаксис для создания индексов в SQLite
   - Убедиться, что все поля имеют корректные типы данных

2. **Автоматическое тестирование**:
   - Создать файл тестов для проверки структуры таблицы
   - Реализовать проверку существования индексов
   - Добавить тесты на соответствие ожидаемой структуре

3. **Логирование операций**:
   - Создать структуру для логирования операций
   - Реализовать функции для записи информационных, ошибочных и отладочных сообщений
   - Добавить логирование выполнения операций с указанием времени

4. **Обработка ошибок**:
   - Добавить обработку возможных ошибок при работе с базой данных
   - Реализовать механизмы восстановления после сбоев

## Влияние на файлы
- `create_rag_table.sql` - исправленный файл с правильным синтаксисом
- `tests/test_rag_table.py` - новый файл с автоматическими тестами
- `agent-service/internal/rag/rag_logger.go` - новый файл с системой логирования

## Подробная реализация
```sql
-- Создание таблицы для хранения документов в RAG
CREATE TABLE IF NOT EXISTS rag_docs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    doc_id TEXT UNIQUE NOT NULL,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    source TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Создание индексов отдельными командами (правильный синтаксис для SQLite)
CREATE INDEX IF NOT EXISTS idx_rag_doc_id ON rag_docs(doc_id);
CREATE INDEX IF NOT EXISTS idx_rag_source ON rag_docs(source);
CREATE INDEX IF NOT EXISTS idx_rag_created_at ON rag_docs(created_at);
```

## Границы и обработка исключений
- Проверка существования базы данных перед выполнением запросов
- Обработка случаев, когда таблица уже существует
- Обработка ошибок при создании индексов
- Логирование всех операций для последующего анализа

## Поток данных
1. Система запускает процесс инициализации базы данных
2. Выполняются запросы по созданию таблицы и индексов
3. Производится проверка успешности выполнения
4. Запускаются автоматические тесты для подтверждения корректности работы
5. Все операции логируются для мониторинга и отладки

## Ожидаемый результат
- Таблица `rag_docs` успешно создана с правильной структурой
- Индексы созданы для ускорения поиска
- Автоматические тесты проходят успешно
- Система логирует все операции
- Новая система полностью соответствует требованиям и готова к использованию